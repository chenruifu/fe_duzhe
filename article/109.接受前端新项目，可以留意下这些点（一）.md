前段时间加入公司内一个新开业务线的前端组，由于是新开的业务线，做的也是小程序这一块，所以几乎没有任何历史包袱，组内成员都是项目代码第一手产出者。

我加入的时机较晚，没有经历过最开始的初创阶段，不太清楚一开始的状况，不过听说是蛮折磨人的，需要踩坑无数，经常需要加班(虽然互联网行业加班本来就是常态，不过现在熬过初始阶段就好多了)，这让我即庆幸又遗憾，庆幸的是我不用加班那么晚了，遗憾的是，没有参与到一条崭新开业务线最开始的建立阶段，不知道以后还有没有这个机会了。

不过，我加入的时机也不是太晚，项目依旧存在很多需要填补的地方，经过这段时间对代码的阅读，以及平时在做需求过程中所遇到的问题，从前端方面，暂时总结出了一些关于项目架构或构建可维护代码方面的小小经验。

## 组件化开发最佳实践

现在前端的组件化开发基本上已经成为主流了，既然已经是组件化开发了，那么自然就要遵守一些组件化开发的最佳实践

### 每个组件文件代码总行数不要超过 400 行

至于为什么是 400行，这个数字是我当初在某篇技术文章上看到的，至于是哪个我忘记，但是不知为何印象很深刻，一直记着，并且根据我~~多年~~具备的经验来看，这个数字还是蛮准确的，一般要么不会超过这个数，或者在这个数字左右徘徊，要么就是比这个数字大很多的

这些都很好理解，既然是组件化开发，那么如果一个组件文件体积太大，存在几十个方法、几十个 data数据(如果用的是 vue框架)，那就说明这个组件大概率包含的功能点太多，是可以被继续细化出多个单一功能的子组件的

太多的方法与 data 数据，对于开发者来说根本就是一种折磨，别的不说，单是给这些方法起名字以及查找都是一件麻烦事，至于日后的维护，那更是噩梦一般的存在，哪怕是当初亲手写下这些代码的程序猿，过一段时间再让他来维护这些代码，他十有八九都要如履薄冰，尽管确认了好多遍，但还是会担心自己修改某个数据或者某个方法，会不会对以前某个较为隐蔽的逻辑造成什么不可预知的破坏，于是一遍又一遍地在几十个方法与数据间测试、检查

我曾经看到过包含七十多个 data 的组件

![2018915223911](http://cdn.chenrf.com/2018915223911.png)

这种情况还算是好的，碰到不负责任的程序猿，可能直接就嫌麻烦，随便在一大堆代码中找个地方写下自己的新代码，检查都不检查就立马提测上线了，因为反正以前上了那么多需求，不小心搞乱了其中某个需求的逻辑，谁特么知道？

这还仅仅是往旧代码中加新代码罢了，如果是下线之前过期的活动代码，或者删除无用的逻辑，那就更让人掉头发了，几十个方法、几十个数据缠在一起，谁知道哪些方法与方法、方法与数据、数据与数据间有着怎样的联系？删掉了这段看起来应该是无用的代码，会不会导致其他有用代码出什么故障？算了算了，不删了，反正后端接口已经关掉，这段代码也显示不出来，就暂时放在上面吧。
殊不知，这所谓的暂时，就是海枯石烂的永远

> 爷爷爷爷，这段代码真的是你写的吗？

于是，页面上无用代码越来越多，旧代码与新代码交相辉映，文件体积迅速增大，随着时间的推移，本来轻装上阵的新鲜代码库，逐渐背上了一个又一个历史包袱，然后被后面接手的人大骂，这写的到底是个什么东西？

> 世上本没有历史包袱，丢包袱的人多了，也就有了历史包袱。

### 每个函数不要超过 100 行

这是接上面的，想想也能明白，一个组件最好不超过 400行，只是一个方法就超过了 100行，那还怎么写？

当然，这里的数字 100根据我的经验，也是蛮准确的，超过这个行数，好好想下，这个方法是不是包含了太多逻辑，遵循函数功能单一原则，不要让一个方法函数包含过多的逻辑功能，是用于拉取数据，那就让它只拉取数据，是用来整合字段的那就让它只整合字段，别干其他的事情

> 多么性感的臀部啊，答应我，别用它来拉shi好吗？

这样一来，方法函数不仅功能明确，维护起来不必畏手畏脚，同时也能够增加方法的复用性，例如，A方法中包含了拉取页面基本数据的功能，后来需求迭代，另外一个后来添加的 B方法也需要拉取页面基础的功能，刚想复用之前 A方法，发现 A方法中除了拉取数据的代码，还有判断是否显示弹窗、修改数据字段、埋点等多个用`if...else...`连起来的代码，于是写 B 方法的人为了避免麻烦，或者发现根本无法复用，只好又把拉取数据的功能重写了一遍

当然，这只是一个原则，实际需求中，如果某两个功能逻辑就是紧密联系不可分割的，你也可以写在一个方法中，总之，在参考这个原则的前提下，灵活变通

## 定义方法与数据要物以类聚

指具备相似能力或者共同作用于某个功能的方法和数据，最好定义在靠近的位置，方便查找，某个功能受到那些方法和数据所控制，某个数据体包含哪些字段全都一目了然，无论是以后要修改还是删除，都能做到胸有成竹，不会遗漏

> 像我这么 diao的还有 107个

例如，页面上与业务无关的工具方法，要放到一起，最好全部放到最后，用户信息的数据都定义在靠近的位置，如果你用的是 vue，那么与模板渲染无关的变量，不要放到 data中，既提升了渲染性能，也易于区分变量的功能

```js
// 工具方法都放到一起
// 金额 分 转 元
fen2yuan(fenNum) {
  return fenNum / 100
}
// 修改链接协议
changeUrl(url) {
  return url.replace('http', 'https')
}

// 用户信息的数据都定义在靠近的位置
// 当然，你甚至可以把下面这些数据，都定义在一个大的对象中
let avatar = 'https://avarat.com/a.png'
let userName = '小明'
let age = 19
```

顺带一提，CSS的书写最好也按照这种规则，CSS书写顺序的判断依据是 css代码影响的方面，例如，影响元素位置的属性 left top，影响元素长相的 color background，字体 font-size font-weight，这些有同类功能的最好都写在一起

另外，我习惯于把能引起页面回流的放在能引起页面的重绘属性的前面，对元素 影响程度 越高的属性越放在最前面，至于什么叫 影响程度 我也说不清楚，下面是我一般写 css的属性的顺序，大家可以自行领悟一下

```html
<!-- position 放在最前面 -->
position: relative;
<!-- 然后是参照 position 进行定位的属性 -->
top: 100px;
left: 10px;
<!-- 然后是宽高 -->
width: 100px;
height: 100px;
line-height: 20px;
<!-- 然后是 margin padding -->
margin: 10px;
padding: 20px 30px;
<!-- font -->
font-size: 20px;
font-weight: 700;
<!-- border -->
border: 1px solid red;
border-radius: 4px;
<!-- background -->
background-color: pink;
<!-- z-index -->
z-index: 10;
```

一开始我也不习惯这种略带有束缚的写法，但是时间长了就习惯了，这些属性的书写顺序，完全不用思考就迅速依次写下，甚至有时候看到别人写的乱七八糟不符合自己习惯的写法，还会顺手改一改。

这样做的好处是易于查找和维护，想改 width，那就肯定是在这个元素 css属性序列的最前面，想改  background，那肯定就从后面扫，也避免了在元素属性过多的情况下，可能导致的某个属性出现多次的情况，我曾经不止一次在代码库中看到某个属性，例如 background写了两次的事情，一个  background写在属性序列的上半部分，然后可能由于这个元素的属性太多,后来维护的人没有看到那个 backgound，或者太乱了也不想看，于是就直接在属性序列的最后面又写了一个

抛开上述的好处不说，最起码这种有条理、有顺序的书写次序，对于某些星座的人来说，看着也赏心悦目，无形之中也能让自己与外面那些妖艳贱货区别开来

> 努力学习却不装逼，那将毫无意义

## 必要而准确的注释

需要长期维护的项目，必要而准确的注释必不可少，甚至宁滥勿缺

一行代码写下去，或许你三天之内还能知道自己当初为什么这么写，里面的变量代表什么意思，有什么作用，但是一个月后呢，半年后呢，一年后呢？就算你记得，其他人呢？

> 我不知道这段代码的作用是什么，但是把它删掉程序就不正常了

如果让你维护一段你早就不记得是谁写的，也不知道到底代表什么意思代码，你要做的第一件事肯定就是先看代码，弄明白到底什么意思，然后才能进行后续维护，而对于某些较为复杂的逻辑代码，例如网站首页，里面嵌入了数十个弹窗，这数十个弹窗分别对应数十个功能点，让你修改其中某个 A弹窗的弹出逻辑，并且还要与另外某个 B弹窗进行优先级配合，光是弄明白A、B弹窗的逻辑你都要花费不少时间吧？

而如果在这段代码上面就有一行对这行代码的准确注释，就算你稍后还是需要读一遍代码，也肯定比没有代码时，你理解的更快更准确
一段代码节约一点时间，那么十段呢？一个文件的代码呢？整个代码库的代码量呢？

所以千万不要觉得注释可有可无，还是那句话，宁滥勿缺，宁愿多写点也不要少写点，你写的代码都是给人读的，反正现在基本上都接自动化打包编译工具（例如 webpack），注释这些东西最后在项目发布阶段都会自动删掉，也不会占用代码体积

## 变量和方法的命名最好有一定的规律

同样是为了更好的阅读体验，也是为了避免过渡注释（宁滥勿缺当然可行，但是少写点无用的注释总不会是坏事），最好的注释就是让代码自己“说出”自己的作用，即命名要有规律性

例如，用于存储数组的变量以 List作为名字后缀，用于某种信息的对象变量以 Info作为名字后缀，用于判断某种逻辑的变量以 is最为前缀，这样一眼看上去就知道变量的大致功能，避免出现让 object类型的对象调用 map的蠢事

```js
const namesList = ['xiaoming', 'xiaohong']
const userInfo = {
  name: 'John',
  age: 20,
  gender: 'male'
}
const isEven = 10 % 2 === 0
```

方法的命名同上，另外，为了更容易体现出方法的功能点，方法的名称最好不要太“宽泛”，例如拉取数据的方法，最好不要命名为类似 getData这种，因为如果这个组件中还存在其他的拉取数据方法，就容易让人迷惑，不会那么一下子就知道这个 getData到底是针对哪个数据接口的，应该进一步精确到相应的接口，例如命名为 getUserData

关于如何给变量以及方法命名这件事，存在很多细致的解决方案，能写两篇文章出来，就不一一展开了

## 通用的功能要封装成组件

通用的组件，最好确定好功能点后，封装成...

未完待续~~

>作者：清夜